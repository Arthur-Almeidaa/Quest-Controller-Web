<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quest Controller Dashboard</title>

  <!-- Fonte -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="painel.css">
</head>

<body>
  <div class="container">

    <!-- HEADER -->
    <header class="header">
      <div class="header-left">
        <div class="logo">üéÆ Quest Controller</div>
        <div class="logo-subtitle">Gerenciamento de Dispositivos VR</div>
      </div>

      <div class="stats">
        <div class="stat-item">
          <div class="stat-value" id="totalDevices">0</div>
          <div class="stat-label">Dispositivos</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="onlineDevices">0</div>
          <div class="stat-label">Online</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalGroups">0</div>
          <div class="stat-label">Grupos</div>
        </div>
        <div class="stat-item stat-logs" id="btnOpenLogs">
          <div class="stat-value">
            üìã
            <span class="notification-badge" id="unreadLogsCount" style="display:none;">0</span>
          </div>
          <div class="stat-label">Logs</div>
        </div>
      </div>
    </header>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab active" data-tab="devices">
        <span class="tab-icon">üì±</span>
        <span>Dispositivos</span>
      </button>
      <button class="tab" data-tab="groups">
        <span class="tab-icon">üë•</span>
        <span>Grupos</span>
      </button>
    </div>

    <!-- DEVICES TAB -->
    <div id="devicesTab" class="tab-content active">
      <div class="action-bar">
        <div class="action-bar-left">
          <select class="form-select" id="deviceAppSelect">
            <option value="">Selecione um App</option>
            <!-- Apps carregados automaticamente do Firebase -->
          </select>
          <button class="btn btn-primary" id="btnExecuteSelected">
            <span>üöÄ</span> Executar Selecionados
          </button>
        </div>
        
        <div class="action-bar-right">
          <button class="btn btn-success" id="btnAddApp">
            <span>‚ûï</span> Novo Jogo
          </button>
          <button class="btn btn-secondary" id="btnToggleApps">
            <span id="toggleAppsIcon">üëÅÔ∏è</span> <span id="toggleAppsText">Ocultar Apps</span>
          </button>
          <button class="btn btn-secondary" id="btnSelectAll">
            <span>‚úì</span> Selecionar Todos
          </button>
          <button class="btn btn-secondary" id="btnDeselectAll">
            <span>‚úó</span> Limpar Sele√ß√£o
          </button>
        </div>
      </div>

      <div id="devicesGrid" class="devices-grid"></div>
    </div>

    <!-- GROUPS TAB -->
    <div id="groupsTab" class="tab-content">
      <div class="action-bar">
        <button class="btn btn-primary" id="btnCreateGroup">
          <span>‚ûï</span> Criar Novo Grupo
        </button>
      </div>
      
      <div id="groupsGrid" class="groups-grid"></div>
    </div>
  </div>

  <!-- MODAL: CRIAR/EDITAR GRUPO -->
  <div id="groupModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Criar Novo Grupo</h2>
        <button class="modal-close" id="btnCloseModal">&times;</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label>Nome do Grupo</label>
          <input type="text" id="groupName" class="form-input" placeholder="Ex: Sala de Aula 1" />
        </div>

        <div class="form-group">
          <label>Aplicativo Padr√£o</label>
          <select id="groupApp" class="form-select">
            <option value="">Nenhum</option>
            <!-- Apps carregados automaticamente do apps-config.js -->
          </select>
        </div>

        <div class="form-group">
          <label>Dispositivos no Grupo</label>
          <div id="devicesList" class="devices-checklist"></div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCancelModal">Cancelar</button>
        <button class="btn btn-danger" id="btnDeleteGroup" style="display:none;">Deletar Grupo</button>
        <button class="btn btn-primary" id="btnSaveGroup">Salvar Grupo</button>
      </div>
    </div>
  </div>

  <!-- MODAL: ADICIONAR/EDITAR APP -->
  <div id="appModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="appModalTitle">‚ûï Adicionar Novo Jogo</h2>
        <button class="modal-close" id="btnCloseAppModal">&times;</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label>Nome do Jogo *</label>
          <input type="text" id="appName" class="form-input" placeholder="Ex: SUPERHOT VR" />
          <small style="color: var(--text-muted); font-size: 12px;">Nome que aparecer√° na interface</small>
        </div>

        <div class="form-group">
          <label>Emoji/√çcone</label>
          <input type="text" id="appIcon" class="form-input" placeholder="üî¥" maxlength="4" />
          <small style="color: var(--text-muted); font-size: 12px;">Emoji que representa o jogo (opcional)</small>
        </div>

        <div class="form-group">
          <label>Package Name (Android) *</label>
          <input type="text" id="appPackage" class="form-input" placeholder="com.empresa.jogo" />
          <small style="color: var(--text-muted); font-size: 12px;">Package name do app no Android/Quest</small>
        </div>

        <div class="form-group">
          <label>ID √önico *</label>
          <input type="text" id="appId" class="form-input" placeholder="superhot" />
          <small style="color: var(--text-muted); font-size: 12px;">Apenas letras min√∫sculas, sem espa√ßos (ex: beatsaber)</small>
        </div>

        <div class="form-group">
          <label>Tipo de Abertura</label>
          <select id="appLaunchType" class="form-select">
            <option value="normal">Normal (Padr√£o)</option>
            <option value="special">Especial (Requer configura√ß√£o no app)</option>
          </select>
          <small style="color: var(--text-muted); font-size: 12px;">Normal: abre via package manager | Especial: c√≥digo customizado no app</small>
        </div>

        <div class="form-group" id="specialActionGroup" style="display: none;">
          <label>A√ß√£o Especial</label>
          <input type="text" id="appSpecialAction" class="form-input" placeholder="BEAT_SABER" />
          <small style="color: var(--text-muted); font-size: 12px;">Nome da a√ß√£o no c√≥digo (ex: BEAT_SABER, BLASTON_VR)</small>
        </div>

        <div class="app-preview" id="appPreview" style="display:none;">
          <div style="padding: 12px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px;">
            <strong style="color: var(--text-secondary);">Preview:</strong>
            <div style="margin-top: 8px; display: flex; align-items: center; gap: 8px;">
              <span id="previewIcon" style="font-size: 20px;">üéÆ</span>
              <span id="previewName" style="color: var(--text-primary); font-weight: 500;">Nome do Jogo</span>
            </div>
            <div style="margin-top: 4px; font-size: 12px; color: var(--text-muted);">
              <code id="previewPackage">com.empresa.jogo</code>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCancelAppModal">Cancelar</button>
        <button class="btn btn-danger" id="btnDeleteApp" style="display:none;">Deletar App</button>
        <button class="btn btn-primary" id="btnSaveApp">‚úÖ Salvar Jogo</button>
      </div>
    </div>
  </div>

  <!-- MODAL: LOGS -->
  <div id="logsModal" class="modal">
    <div class="modal-content modal-logs">
      <div class="modal-header">
        <h2>üìã Hist√≥rico de Comandos</h2>
        <div class="logs-header-actions">
          <button class="btn btn-secondary btn-small" id="btnClearLogs">üóëÔ∏è Limpar Logs</button>
          <button class="modal-close" id="btnCloseLogsModal">&times;</button>
        </div>
      </div>

      <div class="modal-body">
        <div class="logs-filters">
          <select id="logFilterStatus" class="form-select">
            <option value="all">Todos os Status</option>
            <option value="success">‚úÖ Sucesso</option>
            <option value="error">‚ùå Erro</option>
            <option value="pending">‚è≥ Aguardando</option>
            <option value="timeout">‚ö†Ô∏è Timeout</option>
          </select>
          
          <select id="logFilterDevice" class="form-select">
            <option value="all">Todos os Dispositivos</option>
          </select>
        </div>

        <div id="logsContainer" class="logs-list"></div>
      </div>
    </div>
  </div>

  <!-- TOAST NOTIFICATIONS -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- JS -->
  <script type="module" src="painel.js"></script>
</body>
</html>